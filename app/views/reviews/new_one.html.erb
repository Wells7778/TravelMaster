
<div id="new-review" class="section gray">
  <div class="container">

    <div class="card">
      <div class="card-content">
				<h4>遊記投稿</h4>

        <%= form_for @review, url: {controller: 'reviews', action: 'new_one_create'} do |f| %>
          <label for="attraction_name">景點</label>
          <input placeholder="輸入後請選取系統建議值" class="" type="text" name="review[attraction_name]" id="review_attraction_name" autocomplete="off">
          <div style="height: 15px; width: 100%;"></div>
          <div class="input-field">
            <label for="title">標題</label>
            <%= f.text_field :title, placeholder: "請輸入", class:"" %>
          </div>
          <div class="input-field">
            <label for="content">內容：詳細過程、時間、價格等注意事項</label>
            <%= f.text_area :content, placeholder: "請輸入，建議至少100字", class:"materialize-textarea" %>
          </div>
          <div class="input-field">
            <label for="image">圖片：將由Google Vision判別真偽，請提供包含景點特色之圖片</label>
            <div class="imageInputWarpper">
              <label for="imagesInput" class="file-upload">
                  <i class="material-icons">cloud_upload</i>上傳圖檔
              </label>
              <%= f.file_field :images, multiple: true, id: "imagesInput" %>
            </div>
          </div>

          <div id="preview_imgs" style="width:100%; min-height: 50px; margin-bottom: 12px;">
            <p>目前沒有圖片</p>
          </div>
          <div class="input-field">
            <label for="suggestion">對於本景點的分類建議？(Optional)</label>
            <%= f.text_field :suggestion, placeholder: "請輸入，建議分類？" %>
          </div>
          <%= f.submit "提交", {class:"btn"} %>
        <% end %>
        <p style="padding-top: 12px;">*提交後，將由<a href="https://cloud.google.com/vision/docs/other-features#landmarks">Google Vision</a>審核圖片真實性，通過後才會顯示在景點上。</p>

      </div>
    </div>

  </div>
</div>

<%= javascript_tag do %>
  $(function(){

    window.suggestion = {}; //aheadTagFirst傳入下一個script作typeAhead用
    <% @all_names.each do |name| %>
      window.suggestion["<%=name%>"] = "";
    <%end%>

    <%#客製 layout 的變數%>
    $("#mainnav-2").addClass('active');
    $("#sidenav-2").addClass('active');

    $("#nav-bg-img").css("background-image","url(<%= asset_path 'map.jpg' %>)");
    $("#nav-header-h1").text("紀錄旅程點滴");
    $("#nav-header-tag").text("幫助更多喜愛旅遊的人！");

  })
<% end %>

<script>
$(function(){
  $("#imagesInput").change(function(){
    $("#preview_imgs").html(""); // 清除預覽
    readURL(this);
  });

  function readURL(input){
    if (input.files && input.files.length >= 0) {
      for(var i = 0; i < input.files.length; i ++){
        var reader = new FileReader();
        reader.onload = function (e) {
          var img = $("<img width='300' height='200'>").attr('src', e.target.result);
          $("#preview_imgs").append(img);
        }
        reader.readAsDataURL(input.files[i]);
      }
    }else{
       var noPictures = $("<p>目前沒有圖片</p>");
       $("#preview_imgs").append(noPictures);
    }
  }
  
  $('#review_attraction_name').autocomplete({
    data: window.suggestion,
    onAutocomplete: function(val) {
    Materialize.toast('成功選取景點，請勿改變系統建議值', 4000);
    },
  });

});
</script>