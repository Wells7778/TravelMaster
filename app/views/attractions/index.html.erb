<div id="function" class="section">
  <div class="container">
    <div class="function-trigger center">
      <div id="open-search" class="btn">開始旅程</div>
    </div>

    <div class="search-outter center" style="display: none;">

      <div class="grid grid-css">
        <div class="grid-item chip">TAG1</div>
        <div class="grid-item chip">TAG2</div>
        <div class="grid-item chip">TAGasdasd3</div>
      </div>
      <div class="tags-outter">
        <input id="#tags-input" class="typeahead" type="text" data-role="materialtags">
      </div>

    </div>
  </div>
</div>

<div id="portfolio" class="section gray">
  <div class="container">
    <div class="center">
      <h4>精選景點</h4>
    </div>

    <div class="gallery row">

    <% if @show #以controller show進入 %>
      <%= render partial: "spot", locals: {id:@show.id,name: @show.name,address: @show.address,description: @show.description} %>
    <%else #以controller index進入 %>

      <% if @attractions && @attractions.length>0 %>
        <% @attractions.each do |spot| %>
        <%= render partial: "spot", locals: {id:spot.id,name: spot.name,address: spot.address,description: spot.description}%>
        <%end%>
      <% else %>
        不好意思，沒有搜尋結果，請重新嘗試！
      <%end%>
    <%end%>

    </div>
  </div>
</div><!-- /.container -->



<%= javascript_tag do %>
  $(function(){

  <%#客製 layout 的變數%>
  $("#mainnav-1").addClass('active');
  $("#sidenav-1").addClass('active');

  $("#nav-bg-img").css("background-image","url(<%= asset_path 'rock.jpg' %>)");
  $("#nav-header-h1").text("想出門走走？馬上開始");
  $("#nav-header-tag").text("找尋景點好幫手");

  <% if @show #以controller show進入 %>
    $(function(){$('#<%=@show.id%>').galleryExpand('open');})
  <%end%>

  <%#讀取TAGS %>
  <% @traffic_tags.each do |traffic| %>
    $(".grid-item:last").after('<div class="grid-item chip"><%=traffic%></div>');
  <%end%>

  })
<% end %>

<script>

$(function(){

  function openSearch() { //tag initialize
    var $grid = $('.grid').packery({
      itemSelector: '.grid-item',
      // columnWidth helps with drop positioning
      gutter: 10,
      columnWidth: 11,
    });
    $grid.find('.grid-item').each( function( i, gridItem ) {
      var draggie = new Draggabilly( gridItem );
      // bind drag events to Packery
      $grid.packery( 'bindDraggabillyEvents', draggie );
    });

    $grid.on( 'click', '.grid-item', function( event ) {
      $grid.packery( 'remove', event.currentTarget ).packery('shiftLayout');
      // shiftLayout remaining item elements
      $('input').materialtags('add', event.currentTarget.innerText );
      $('.n-tag').val("");
    });

    $('input').on('beforeItemRemove', function(event) {
      var $items = $('<div class="grid-item chip">'+event.item+'</div>');
      // prepend items to grid
      $grid.prepend( $items )
      // add and lay out newly prepended items
      .packery( 'prepended', $items );
    });

  };

  $( "#open-search" ).click(function() {
    $( "#open-search" ).toggle();
    $( ".search-outter" ).slideDown( "slow" );
    openSearch();
  });

  var onShow = function(el) {
    console.log();
    history.pushState({},"","/attractions/"+el.attr('id'));
    //消除的部分在galleryExpand.js
  };

  $('.gallery-expand').galleryExpand({
    onShow: onShow,
  });

  var $masonry = $('.gallery');
  $masonry.masonry({
    // set itemSelector so .grid-sizer is not used in layout
    itemSelector: '.gallery-item',
    // use element for option
    columnWidth: '.gallery-item',
  });

  // layout Masonry after each image loads
  $masonry.imagesLoaded(function() {
    $masonry.masonry('layout');
  });

}); // end of document ready

</script>